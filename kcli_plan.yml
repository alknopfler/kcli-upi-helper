{{ image }}:
 type: image
 url: {{ image_url }}

{% if virtual_bootstrap %}
{{ cluster }}-bootstrap:
 pool: {{ pool }} 
 numcpus: {{ virtual_bootstrap_numcpus }}
 cloudinit: false
 start: false
 iso: {{ cluster }}-bootstrap.iso
 memory: {{ virtual_bootstrap_memory }}
 nets:
  - name: {{ provisioning_net }}
    mac: {{ virtual_bootstrap_mac }}
 disks:
{%- for size in [disk_size] + extra_disks %}
  - {{ size }}
{%- endfor %}
{%- endif %}

{% if virtual_masters %}
{%- for num in range(0, virtual_masters_number) %}
{{ cluster }}-master-{{ num }}:
 pool: {{ pool }}
 numcpus: {{ virtual_masters_numcpus }}
 cloudinit: false
 start: false
 iso: {{ cluster }}-master.iso
 memory: {{ virtual_masters_memory }}
 nets:
  - name: {{ provisioning_net }}
    mac: {{ virtual_masters_mac_prefix + ":" + "%02.d" | format(num + 1)| string }}
 disks:
{%- for size in [disk_size] + extra_disks %}
  - {{ size }}
{%- endfor %}
{%- endfor %}
{%- endif %}

{% if virtual_workers %}
{%- for num in range(0, virtual_workers_number) %}
{{ cluster }}-worker-{{ num }}:
 pool: {{ pool }}
 numcpus: {{ virtual_workers_numcpus }}
 cloudinit: false
 start: false
 iso: {{ cluster }}-worker.iso
 memory: {{ virtual_workers_memory }}
 nets:
  - name: {{ provisioning_net }}
    mac: {{ virtual_workers_mac_prefix + ":" + "%02.d" | format(num + 1)| string }}
 disks:
{%- for size in [disk_size] + extra_disks %}
  - {{ size }}
{%- endfor %}
{%- endfor %}
{%- endif %}

{{ cluster }}-installer: 
 image: {{ image }} 
 pool: {{ pool }} 
 numcpus: {{ numcpus }}
 keys: {{ keys }}
{%- if 'rhel' in image %}
 rhnregister: {{ rhnregister }}
 networkwait: {{ rhnwait }}
{%- endif %}
 memory: {{ memory }}
 notify: {{ notify }}
 notifyscript: {{ notifyscript }}
 nets:                                                                                                                                         
 - name: {{ baremetal_net }}
 - name: {{ provisioning_net }}
   ip: {{ installer_ip }}
   mask: {{ installer_mask }}
   gateway: {{ installer_gateway }}
   vips:
   - {{ api_ip }}
   - {{ ingress_ip }}
 disks:
 - {{ disk_size }}
 files:
 - 01_patch_installconfig.sh
 - 02_packages.sh
 - 03_network.sh
 - 04_get_clients.sh
 - 05_disconnected.sh
{% if olm %}
 - 06_olm.sh
{% endif %}
 - 07_nbde.sh
 - 08_ntp.sh
 - 09_deploy_openshift.sh
 - 10_create_isos.sh
 - path: /root/bin/fix_disconnected_packages.sh
   origin: helpers/fix_disconnected_packages.sh
 - path: /root/bin/small_iso.sh
   origin: helpers/create_small_iso.sh
 - install-config.yaml                                                                                                                           
 - .bashrc
 - iso.sh
 - iso.ign.template
 - create_iso_ignition.py
 - origin: {{ pullsecret }}
   path: /root/openshift_pull.json                                                                                                                    
 - path: /root/manifests
   origin: manifests
 - 99-openshift-tang-encryption-clevis.sample.yaml
 - 99-openshift-tang-encryption-ka.sample.yaml
 - 99-openshift-chrony.sample.yaml
 - dnsmasq.conf
 - path: /opt/hosts
   origin: hosts
   mode: 755
 - haproxy.cfg
 - radvd.conf
 scripts:
 - deploy.sh
